<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Will you be my Valentine Andrew Getzow?</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      /* --------- Complex dreamy background --------- */
      body {
        background:
          radial-gradient(900px 520px at 20% 15%, rgba(255, 182, 193, 0.55), transparent 60%),
          radial-gradient(900px 520px at 80% 25%, rgba(255, 105, 180, 0.28), transparent 60%),
          radial-gradient(900px 520px at 55% 85%, rgba(147, 197, 253, 0.35), transparent 60%),
          linear-gradient(180deg, #fff1f2 0%, #ffe4e6 40%, #fdf2f8 70%, #eff6ff 100%);
      }

      /* Boss mode tint (kicks in when NO gets spicy) */
      body.boss-mode::before{
        content:"";
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
        background:
          radial-gradient(900px 520px at 55% 55%, rgba(15, 23, 42, 0.55), transparent 65%),
          linear-gradient(180deg, rgba(15,23,42,0.25), rgba(0,0,0,0.10));
        opacity: 0.85;
        mix-blend-mode: multiply;
      }

      /* ---------- BIG FULL-WIDTH TITLE ---------- */
      #bigTitle{
        position: relative;
        z-index: 3;
        text-align: center;
        font-weight: 900;
        letter-spacing: -0.02em;
        line-height: 0.95;
        font-size: clamp(2.2rem, 6vw, 4.6rem);
        color: #ffffff;
        text-shadow:
          0 4px 0 rgba(0,0,0,0.15),
          0 10px 28px rgba(0,0,0,0.22);
        margin-bottom: 1.25rem;
      }

      /* The pink pill behind the title */
      #bigTitle span{
        display: inline-block;
        padding: 0.18em 0.42em;
        border-radius: 999px;
        background: rgba(244, 63, 94, 0.20);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.35);
      }

      /* Make the pink pill a positioning container */
      #titlePill{
        position: relative;
        display: inline-block;
        overflow: hidden; /* keep stamp inside pill */
      }

      /* âœ… Updated: LETS GOOOO off to the side (right), all black */
      #letsGo{
        position: absolute;
        right: 22px;            /* move to the side where thereâ€™s no text */
        top: 50%;
        transform: translateY(-50%) rotate(-12deg) scale(0.7);
        font-weight: 1000;
        font-size: clamp(1.15rem, 3vw, 2.1rem);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: rgba(0,0,0,0.92);           /* all black */
        text-shadow: 0 10px 18px rgba(0,0,0,0.18); /* soft depth */
        opacity: 0;
        pointer-events: none;
        white-space: nowrap;
        z-index: 6;
      }
      #letsGo.show{
        opacity: 1;
        animation: letsGoPop 650ms cubic-bezier(.2,.9,.2,1) forwards;
      }
      @keyframes letsGoPop{
        0%   { transform: translateY(-50%) rotate(-12deg) scale(0.55); opacity: 0; }
        60%  { transform: translateY(-50%) rotate(-12deg) scale(1.05); opacity: 1; }
        100% { transform: translateY(-50%) rotate(-12deg) scale(0.92); opacity: 1; }
      }

      #bg {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }

      .blob {
        position: absolute;
        width: 520px;
        height: 520px;
        border-radius: 999px;
        filter: blur(55px);
        opacity: 0.55;
        transform: translate3d(0,0,0);
        mix-blend-mode: multiply;
        will-change: transform;
      }

      .blob.a {
        left: -140px;
        top: -160px;
        background: radial-gradient(circle at 30% 30%, rgba(244, 63, 94, 0.55), rgba(255, 182, 193, 0.25) 55%, transparent 70%);
        animation: floatA 14s ease-in-out infinite;
      }

      .blob.b {
        right: -160px;
        top: -120px;
        background: radial-gradient(circle at 30% 30%, rgba(236, 72, 153, 0.45), rgba(147, 197, 253, 0.22) 55%, transparent 70%);
        animation: floatB 16s ease-in-out infinite;
      }

      .blob.c {
        left: 10%;
        bottom: -210px;
        background: radial-gradient(circle at 30% 30%, rgba(147, 197, 253, 0.45), rgba(244, 63, 94, 0.18) 55%, transparent 70%);
        animation: floatC 18s ease-in-out infinite;
      }

      @keyframes floatA {
        0%, 100% { transform: translate(0px, 0px) scale(1); }
        50%      { transform: translate(80px, 60px) scale(1.08); }
      }
      @keyframes floatB {
        0%, 100% { transform: translate(0px, 0px) scale(1); }
        50%      { transform: translate(-90px, 70px) scale(1.06); }
      }
      @keyframes floatC {
        0%, 100% { transform: translate(0px, 0px) scale(1); }
        50%      { transform: translate(120px, -60px) scale(1.1); }
      }

      /* Boss mode = faster blobs */
      body.boss-mode .blob.a{ animation-duration: 9s; }
      body.boss-mode .blob.b{ animation-duration: 10s; }
      body.boss-mode .blob.c{ animation-duration: 11s; }

      /* subtle noise overlay */
      .noise {
        position: absolute;
        inset: 0;
        opacity: 0.10;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
        background-size: 180px 180px;
      }

      /* pixel grid overlay */
      .pixel-grid{
        position:absolute;
        inset:0;
        opacity:.08;
        background-image:
          linear-gradient(to right, rgba(15,23,42,.25) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(15,23,42,.25) 1px, transparent 1px);
        background-size: 26px 26px;
        mix-blend-mode: overlay;
      }

      /* Nintendo-ish polish */
      .pixel-vibe { text-shadow: 0 2px 0 rgba(0,0,0,0.08); }
      .mascot-bounce { animation: mascotBounce 1.8s ease-in-out infinite; }
      @keyframes mascotBounce { 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-6px); } }

      /* Power-ups layer */
      #powerups{
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 1;
        overflow: hidden;
      }
      .powerup{
        position: absolute;
        bottom: -40px;
        opacity: 0;
        animation: puFloat linear forwards;
        filter: drop-shadow(0 6px 10px rgba(0,0,0,0.12));
        will-change: transform, opacity;
        user-select: none;
      }
      @keyframes puFloat{
        0%   { transform: translateY(0) translateX(0) scale(.9) rotate(0deg); opacity: 0; }
        12%  { opacity: .9; }
        100% { transform: translateY(-120vh) translateX(var(--drift)) scale(1.2) rotate(var(--rot)); opacity: 0; }
      }

      /* Hearts */
      #hearts {
        position: fixed;
        inset: 0;
        overflow: hidden;
        pointer-events: none;
        z-index: 2;
      }
      .heart {
        position: absolute;
        bottom: -40px;
        will-change: transform, opacity;
        animation: floatUp linear forwards;
        filter: drop-shadow(0 6px 10px rgba(0,0,0,0.08));
        user-select: none;
      }
      @keyframes floatUp {
        0%   { transform: translateY(0) translateX(0) scale(1); opacity: 0; }
        10%  { opacity: 0.85; }
        100% { transform: translateY(-120vh) translateX(var(--drift)) scale(1.15); opacity: 0; }
      }

      /* Card */
      .card {
        position: relative;
        z-index: 3;
        background: rgba(255, 255, 255, 0.78);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        border: 1px solid rgba(255, 255, 255, 0.65);
        box-shadow: 0 22px 70px rgba(0,0,0,0.14);
      }

      #valImage {
        background: linear-gradient(135deg, rgba(255,192,203,0.25), rgba(173,216,230,0.25));
      }

      /* Heart buttons (SVG) */
      .svg-heart{
        width: 56px;
        height: 50px;
        border: 0;
        background: transparent;
        padding: 0;
        cursor: pointer;
        position: relative;
        filter: drop-shadow(0 10px 14px rgba(0,0,0,.16));
        transition: transform .12s ease, filter .12s ease;
        will-change: transform;
      }

      .svg-heart svg{ width: 100%; height: 100%; display: block; }
      .svg-heart.yes path{ fill: #ef4444; }
      .svg-heart.no  path{ fill: #f43f5e; }

      .svg-heart span{
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-4px);
        color: white;
        font-weight: 900;
        font-size: 11px;
        letter-spacing: .7px;
        text-shadow: 0 1px 2px rgba(0,0,0,.25);
        user-select: none;
        pointer-events: none;
      }

      .svg-heart:hover{
        transform: scale(1.06);
        filter: drop-shadow(0 12px 18px rgba(0,0,0,.18));
      }
      .svg-heart:active{ transform: scale(.96); }

      .svg-heart:focus-visible{
        outline: 3px solid rgba(239, 68, 68, .35);
        outline-offset: 6px;
      }
    </style>
  </head>

  <body class="min-h-screen flex flex-col items-center justify-center p-6">
    <div id="bg" aria-hidden="true">
      <div class="blob a"></div>
      <div class="blob b"></div>
      <div class="blob c"></div>
      <div class="noise"></div>
      <div class="pixel-grid"></div>
    </div>

    <div id="powerups" aria-hidden="true"></div>
    <div id="hearts" aria-hidden="true"></div>

    <h1 id="bigTitle" class="w-full px-4">
      <span id="titlePill">
        Will you be my Valentine Andrew Getzow? Pretty Pleases? ðŸ’˜
        <span id="letsGo">LETS GOOOO</span>
      </span>
    </h1>

    <div class="card rounded-3xl p-7 max-w-md w-full text-center">
      <div class="mx-auto mb-3 w-28 mascot-bounce">
        <div class="w-24 h-24 mx-auto">
          <svg viewBox="0 0 128 128" class="w-full h-full drop-shadow-sm" aria-hidden="true">
            <path d="M40 24 L64 10 L88 24 L82 44 H46 Z" fill="#fbbf24"/>
            <circle cx="64" cy="22" r="6" fill="#f59e0b"/>
            <ellipse cx="64" cy="62" rx="34" ry="28" fill="#60a5fa"/>
            <ellipse cx="64" cy="70" rx="26" ry="18" fill="#93c5fd" opacity="0.9"/>
            <ellipse cx="52" cy="58" rx="7" ry="10" fill="#0f172a"/>
            <ellipse cx="76" cy="58" rx="7" ry="10" fill="#0f172a"/>
            <circle cx="50" cy="55" r="2" fill="#fff"/>
            <circle cx="74" cy="55" r="2" fill="#fff"/>
            <path d="M64 64 C56 62 56 74 64 76 C72 74 72 62 64 64 Z" fill="#f59e0b"/>
            <path d="M30 92 C34 78 48 72 64 72 C80 72 94 78 98 92
                     C90 108 78 118 64 118 C50 118 38 108 30 92 Z"
                  fill="#ef4444"/>
            <path d="M38 94 C44 104 54 110 64 110 C74 110 84 104 90 94"
                  stroke="#fff" stroke-width="8" stroke-linecap="round" opacity="0.9"/>
            <rect x="92" y="70" width="8" height="30" rx="3" fill="#334155"/>
            <rect x="84" y="60" width="26" height="14" rx="6" fill="#475569"/>
            <circle cx="84" cy="67" r="6" fill="#475569"/>
          </svg>
        </div>

        <div class="mt-1 text-center font-extrabold text-sm tracking-wide text-slate-800/80 pixel-vibe">
          2/14/26
        </div>
      </div>

      <img id="valImage" class="w-full h-64 object-cover rounded-xl mb-5" alt="Valentine gif" />

      <div class="flex gap-6 justify-center mt-2">
        <button id="yesBtn" class="svg-heart yes" type="button" aria-label="Yes">
          <svg viewBox="0 0 32 29" aria-hidden="true">
            <path d="M23.6,0c-3,0-5.2,1.7-6.6,3.6C15.6,1.7,13.4,0,10.4,0C4.9,0,0.8,4.9,1.1,10.4
              c0.6,9.2,14.9,18.2,15.9,18.6c1-0.4,15.3-9.4,15.9-18.6C33.2,4.9,29.1,0,23.6,0z"/>
          </svg>
          <span>YES</span>
        </button>

        <button id="noBtn" class="svg-heart no" type="button" aria-label="No">
          <svg viewBox="0 0 32 29" aria-hidden="true">
            <path d="M23.6,0c-3,0-5.2,1.7-6.6,3.6C15.6,1.7,13.4,0,10.4,0C4.9,0,0.8,4.9,1.1,10.4
              c0.6,9.2,14.9,18.2,15.9,18.6c1-0.4,15.3-9.4,15.9-18.6C33.2,4.9,29.1,0,23.6,0z"/>
          </svg>
          <span>NO</span>
        </button>
      </div>

      <p id="hint" class="text-sm text-gray-600 mt-4">
        Tip: click a button. If a GIF host blocks embeds, itâ€™ll auto-try another link.
      </p>
    </div>

    <script>
      // ------------------ Moving hearts ------------------
      const heartsLayer = document.getElementById("hearts");

      function spawnHeart() {
        const el = document.createElement("span");
        el.className = "heart";
        el.textContent = Math.random() > 0.25 ? "ðŸ’—" : "ðŸ’–";

        const left = Math.random() * 100;
        const size = 14 + Math.random() * 28;
        const dur  = 5 + Math.random() * 7;
        const drift = (Math.random() * 60 - 30) + "px";

        el.style.left = left + "vw";
        el.style.fontSize = size + "px";
        el.style.opacity = (0.30 + Math.random() * 0.50).toFixed(2);
        el.style.animationDuration = dur + "s";
        el.style.setProperty("--drift", drift);

        heartsLayer.appendChild(el);
        setTimeout(() => el.remove(), dur * 1000 + 100);
      }

      for (let i = 0; i < 14; i++) spawnHeart();
      setInterval(spawnHeart, 220);

      // ------------------ Power-ups particles ------------------
      const powerupsLayer = document.getElementById("powerups");

      function spawnPowerup(){
        const el = document.createElement("span");
        el.className = "powerup";
        const items = ["â­","ðŸª™","âœ¨","ðŸ’–","ðŸŽ®"];
        el.textContent = items[Math.floor(Math.random() * items.length)];

        const left = Math.random() * 100;
        const size = 14 + Math.random() * 22;
        const dur  = 6 + Math.random() * 8;
        const drift = (Math.random() * 80 - 40) + "px";
        const rot = (Math.random() * 160 - 80) + "deg";

        el.style.left = left + "vw";
        el.style.fontSize = size + "px";
        el.style.animationDuration = dur + "s";
        el.style.setProperty("--drift", drift);
        el.style.setProperty("--rot", rot);

        powerupsLayer.appendChild(el);
        setTimeout(() => el.remove(), dur * 1000 + 200);
      }

      for (let i = 0; i < 10; i++) spawnPowerup();
      setInterval(spawnPowerup, 600);

      // ------------------ GIF loader ------------------
      const valImage = document.getElementById("valImage");
      const hint = document.getElementById("hint");

      function setImageTry(urls, failMessage) {
        let i = 0;
        const tryNext = () => {
          if (i >= urls.length) { hint.textContent = failMessage; return; }
          const url = urls[i++];

          const probe = new Image();
          probe.onload = () => { valImage.src = url; hint.textContent = ""; };
          probe.onerror = () => tryNext();
          probe.src = url;
        };
        tryNext();
      }

      const yesBtn = document.getElementById("yesBtn");
      const noBtn = document.getElementById("noBtn");

      const GIFS = {
        start: ["https://media1.tenor.com/m/rcvI6iu2HrYAAAAd/pokemon-eevee-eevee.gif"],
        yesMain: ["https://media1.tenor.com/m/hmEGDJNxK0cAAAAd/eevee.gif"],
        yesFinal: [
          "https://media1.tenor.com/m/hmEGDJNxK0cAAAAd/eevee.gif",
          "https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExcnd5OW94bW81Zzg5MXpyMHB6eTE0azRiMGU5OHhlYTl4MmNiMHh6biZlcD12MV9naWZzX3NlYXJjaCZjdD1n/TqK5V0YnrWaR2/200.gif"
        ],
        no: ["https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExanJvMHd5MXBwYjJsaWUxeTNrc3ptdHYzNnpndDhncXoyYzN0bnJxZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/oabY4xGwzUB8c/giphy.gif"]
      };

      setImageTry(GIFS.start, "Start GIF failed to load.");

      // ------------------ Chest-fanfare (original) ------------------
      function playGlueSong() {
        try {
          const AudioCtx = window.AudioContext || window.webkitAudioContext;
          const ctx = new AudioCtx();
          if (ctx.state === "suspended") ctx.resume();

          const now = ctx.currentTime;
          const bpm = 132;
          const beat = 60 / bpm;

          const delay = ctx.createDelay(1.0);
          delay.delayTime.value = 0.12;

          const feedback = ctx.createGain();
          feedback.gain.value = 0.25;

          const wet = ctx.createGain();
          wet.gain.value = 0.35;

          const dry = ctx.createGain();
          dry.gain.value = 0.85;

          delay.connect(feedback);
          feedback.connect(delay);
          delay.connect(wet);
          wet.connect(ctx.destination);
          dry.connect(ctx.destination);

          const noteToFreq = (note) => {
            if (note === "REST") return null;
            const m = /^([A-G])(#|b)?(\d)$/.exec(note);
            if (!m) return null;

            const [, letter, accidental, octaveStr] = m;
            const octave = Number(octaveStr);
            const SEMI = { C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 };

            let n = SEMI[letter];
            if (accidental === "#") n += 1;
            if (accidental === "b") n -= 1;

            const midi = (octave + 1) * 12 + n;
            return 440 * Math.pow(2, (midi - 69) / 12);
          };

          function schedule(sequence, {
            type = "triangle",
            volume = 0.12,
            offset = 0,
            detune = 0,
            toDelay = true
          } = {}) {
            let t = now + offset;
            for (const step of sequence) {
              const dur = step.beats * beat;
              const freq = noteToFreq(step.note);
              if (freq) {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, t);
                osc.detune.setValueAtTime(detune, t);

                const attack = Math.min(0.012, dur * 0.25);
                const release = Math.min(0.09, dur * 0.45);

                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(volume, t + attack);
                gain.gain.setValueAtTime(volume, t + Math.max(attack, dur - release));
                gain.gain.linearRampToValueAtTime(0, t + dur);

                osc.connect(gain);
                gain.connect(dry);
                if (toDelay) gain.connect(delay);

                osc.start(t);
                osc.stop(t + dur);
              }
              t += dur;
            }
            return t;
          }

          const lead = [
            { note: "C5", beats: 0.5 }, { note: "E5", beats: 0.5 }, { note: "G5", beats: 0.5 }, { note: "C6", beats: 1.5 },
            { note: "B5", beats: 0.5 }, { note: "C6", beats: 2 },
            { note: "G5", beats: 0.5 }, { note: "C6", beats: 2.5 }
          ];
          const harmony = [
            { note: "E4", beats: 0.5 }, { note: "G4", beats: 0.5 }, { note: "C5", beats: 0.5 }, { note: "E5", beats: 1.5 },
            { note: "D5", beats: 0.5 }, { note: "E5", beats: 2 },
            { note: "C5", beats: 0.5 }, { note: "E5", beats: 2.5 }
          ];
          const bass = [
            { note: "C3", beats: 1 }, { note: "REST", beats: 1 },
            { note: "G3", beats: 1 }, { note: "REST", beats: 1 },
            { note: "C3", beats: 2 },
          ];
          const sparkle = [
            { note: "C6", beats: 0.25 }, { note: "E6", beats: 0.25 }, { note: "G6", beats: 0.25 }, { note: "C7", beats: 0.25 },
            { note: "B6", beats: 0.25 }, { note: "G6", beats: 0.25 }, { note: "E6", beats: 0.25 }, { note: "C6", beats: 0.25 },
            { note: "D6", beats: 0.25 }, { note: "F6", beats: 0.25 }, { note: "A6", beats: 0.25 }, { note: "D7", beats: 0.25 },
            { note: "C7", beats: 0.25 }, { note: "A6", beats: 0.25 }, { note: "F6", beats: 0.25 }, { note: "D6", beats: 0.25 },
            { note: "E6", beats: 0.25 }, { note: "G6", beats: 0.25 }, { note: "C7", beats: 0.25 }, { note: "E7", beats: 0.25 },
            { note: "D7", beats: 0.25 }, { note: "C7", beats: 0.25 }, { note: "G6", beats: 0.25 }, { note: "E6", beats: 0.25 },
          ];

          const t1 = schedule(lead,    { type: "triangle", volume: 0.14, offset: 0.00, detune: +4 });
          const t2 = schedule(harmony, { type: "sine",     volume: 0.10, offset: 0.02, detune: -3 });
          const t3 = schedule(bass,    { type: "square",   volume: 0.06, offset: 0.00, detune:  0, toDelay: false });
          const t4 = schedule(sparkle, { type: "sine",     volume: 0.07, offset: 0.10, detune: +6 });

          const end = Math.max(t1, t2, t3, t4);
          setTimeout(() => ctx.close().catch(() => {}), Math.ceil((end - now + 0.35) * 1000));
        } catch {}
      }

      let yesFinalTimer = null;

      // ------------------ NO button gets huge + runs away ------------------
      let noScale = 1;
      let noDodges = 0;

      function applyNoTransform(extra = "") {
        const capped = Math.min(noScale, 4.5);
        noBtn.style.transform = `translate(${noBtn.dataset.tx || 0}px, ${noBtn.dataset.ty || 0}px) scale(${capped}) ${extra}`;
      }

      noBtn.addEventListener("mouseenter", () => {
        if (noDodges < 2) return;

        const rect = noBtn.getBoundingClientRect();
        const pad = 12;

        const maxX = window.innerWidth - rect.width - pad;
        const maxY = window.innerHeight - rect.height - pad;

        const tx = Math.floor(Math.random() * maxX) - rect.left + pad;
        const ty = Math.floor(Math.random() * maxY) - rect.top + pad;

        noBtn.dataset.tx = tx;
        noBtn.dataset.ty = ty;

        noBtn.style.transition = "transform 0.15s ease";
        applyNoTransform();
      });

      // ------------------ Battle music (original, looped) ------------------
      let battleCtx = null;
      let battleMaster = null;
      let battleInterval = null;
      let battleStep = 0;
      let battleIntensity = 1;

      function noiseHit(ctx, time, duration, volume, cutoffHz) {
        const bufferSize = Math.floor(ctx.sampleRate * duration);
        const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1);

        const src = ctx.createBufferSource();
        src.buffer = buffer;

        const filter = ctx.createBiquadFilter();
        filter.type = "lowpass";
        filter.frequency.setValueAtTime(cutoffHz, time);

        const gain = ctx.createGain();
        gain.gain.setValueAtTime(0, time);
        gain.gain.linearRampToValueAtTime(volume, time + 0.005);
        gain.gain.exponentialRampToValueAtTime(0.0001, time + duration);

        src.connect(filter).connect(gain).connect(battleMaster);
        src.start(time);
        src.stop(time + duration);
      }

      function noteToFreqBattle(note) {
        const m = /^([A-G])(#|b)?(\d)$/.exec(note);
        if (!m) return null;
        const [, letter, accidental, octaveStr] = m;
        const octave = Number(octaveStr);
        const SEMI = { C:0, D:2, E:4, F:5, G:7, A:9, B:11 };
        let n = SEMI[letter];
        if (accidental === "#") n += 1;
        if (accidental === "b") n -= 1;
        const midi = (octave + 1) * 12 + n;
        return 440 * Math.pow(2, (midi - 69) / 12);
      }

      function startBattleMusic(intensity = 1) {
        if (battleCtx) return;

        battleIntensity = intensity;

        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        battleCtx = new AudioCtx();
        if (battleCtx.state === "suspended") battleCtx.resume();

        battleMaster = battleCtx.createGain();
        battleMaster.gain.value = 0.12 + Math.min(battleIntensity, 6) * 0.02;
        battleMaster.connect(battleCtx.destination);

        battleStep = 0;

        const tick = () => {
          if (!battleCtx) return;

          const capped = Math.max(1, Math.min(battleIntensity, 6));
          const bpm = 120 + capped * 10;
          const stepDur = 60 / bpm / 2;
          const t = battleCtx.currentTime + 0.02;

          const riff = ["E3","G3","A3","G3","E3","D3","E3","B2"];
          const lead = ["E4","G4","A4","B4","A4","G4","E4","D4"];

          const bassNote = riff[battleStep % riff.length];
          const bassOsc = battleCtx.createOscillator();
          bassOsc.type = "sawtooth";
          bassOsc.frequency.setValueAtTime(noteToFreqBattle(bassNote), t);

          const bassGain = battleCtx.createGain();
          bassGain.gain.setValueAtTime(0, t);
          bassGain.gain.linearRampToValueAtTime(0.12 + capped * 0.01, t + 0.01);
          bassGain.gain.exponentialRampToValueAtTime(0.0001, t + stepDur);

          const bassFilter = battleCtx.createBiquadFilter();
          bassFilter.type = "lowpass";
          bassFilter.frequency.setValueAtTime(600 + capped * 180, t);

          bassOsc.connect(bassFilter).connect(bassGain).connect(battleMaster);
          bassOsc.start(t);
          bassOsc.stop(t + stepDur);

          if (battleStep % 2 === 0) {
            const leadNote = lead[(battleStep / 2) % lead.length];
            const leadOsc = battleCtx.createOscillator();
            leadOsc.type = "square";
            leadOsc.frequency.setValueAtTime(noteToFreqBattle(leadNote), t);

            const leadGain = battleCtx.createGain();
            leadGain.gain.setValueAtTime(0, t);
            leadGain.gain.linearRampToValueAtTime(0.07 + capped * 0.008, t + 0.008);
            leadGain.gain.exponentialRampToValueAtTime(0.0001, t + stepDur * 0.9);

            leadOsc.connect(leadGain).connect(battleMaster);
            leadOsc.start(t);
            leadOsc.stop(t + stepDur * 0.9);
          }

          const isKick = battleStep % 4 === 0 || battleStep % 4 === 2;
          const isSnare = battleStep % 4 === 1 || battleStep % 4 === 3;

          if (isKick)  noiseHit(battleCtx, t, 0.06, 0.10 + capped * 0.01, 220 + capped * 20);
          if (isSnare) noiseHit(battleCtx, t, 0.05, 0.06 + capped * 0.008, 1200 + capped * 120);
          noiseHit(battleCtx, t, 0.02, 0.03 + capped * 0.004, 6000 + capped * 300);

          battleStep++;
        };

        battleInterval = setInterval(tick, 90);
        tick();
      }

      function updateBattleIntensity(intensity) {
        battleIntensity = intensity;
        if (!battleCtx) return;
        battleMaster.gain.value = 0.12 + Math.min(battleIntensity, 6) * 0.02;
      }

      function stopBattleMusic() {
        if (battleInterval) clearInterval(battleInterval);
        battleInterval = null;

        if (battleCtx) {
          const ctx = battleCtx;
          battleCtx = null;
          battleMaster = null;
          setTimeout(() => ctx.close().catch(() => {}), 50);
        }
      }

      function maybeBossMode() {
        if (noDodges >= 3) document.body.classList.add("boss-mode");
      }

      // ------------------ YES / NO click handlers ------------------
      yesBtn.addEventListener("click", () => {
        // âœ… show LETS GOOOO (black, on the right side of pill)
        document.getElementById("letsGo")?.classList.add("show");

        stopBattleMusic();
        document.body.classList.remove("boss-mode");

        setImageTry(GIFS.yesMain, "YES GIF failed to load.");
        hint.textContent = "You are now my Valentine FOREVER...er I mean um, for uh 2026! ðŸ’™";
        noBtn.style.display = "none";

        playGlueSong();
        confetti({ particleCount: 250, spread: 80, origin: { y: 0.6 } });

        if (yesFinalTimer) clearTimeout(yesFinalTimer);
        yesFinalTimer = setTimeout(() => {
          setImageTry(GIFS.yesFinal, "Final Eevee GIF failed to load.");
        }, 2000);
      });

      noBtn.addEventListener("click", () => {
        setImageTry(GIFS.no, "NO GIF failed to load.");
        hint.textContent = "No (Are you sure about that?) ðŸ˜³";

        noScale *= 1.35;
        noDodges += 1;

        startBattleMusic(noDodges);
        updateBattleIntensity(noDodges);
        maybeBossMode();

        const capped = Math.min(noScale, 4.5);

        noBtn.animate(
          [
            { transform: `translate(${noBtn.dataset.tx || 0}px, ${noBtn.dataset.ty || 0}px) scale(${capped}) rotate(0deg)` },
            { transform: `translate(${noBtn.dataset.tx || 0}px, ${noBtn.dataset.ty || 0}px) scale(${capped}) rotate(-7deg)` },
            { transform: `translate(${noBtn.dataset.tx || 0}px, ${noBtn.dataset.ty || 0}px) scale(${capped}) rotate(7deg)` },
            { transform: `translate(${noBtn.dataset.tx || 0}px, ${noBtn.dataset.ty || 0}px) scale(${capped}) rotate(0deg)` },
          ],
          { duration: 220, iterations: 1 }
        );

        applyNoTransform();
      });
    </script>
  </body>
</html>

    </script>
  </body>
</html>
